<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">

<head>
  <script src="bootstrap-4.0.0-dist/js/color-modes.js"></script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.112.5">
  <title>Dashboard</title>

  <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/dashboard/">
  <link href="bootstrap-4.0.0-dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="dashboard.css" rel="stylesheet">
  <!--For styling & Other Resources-->
  <script src="bootstrap-4.0.0-dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"
    integrity="sha384-gdQErvCNWvHQZj6XZM0dNsAoY4v+j5P1XDpNkcM3HJG1Yx04ecqIHk7+4VBOCHOG"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" crossorigin="anonymous"
    referrerpolicy="no-referrer"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

</head>

<body class="mainbody">
  <div class="container-fluid">
    <div class="row">
      <div class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary">
        <div class="offcanvas-lg offcanvas-end bg-body-tertiary" tabindex="-1" id="sidebarMenu"
          aria-labelledby="sidebarMenuLabel">
          <div class="offcanvas-header">
            <!--h5 class="offcanvas-title" id="sidebarMenuLabel">Company name</h5-->
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu"
              aria-label="Close"></button>
          </div>
          <div class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2 active" aria-current="page" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-house-fill" viewBox="0 0 16 16">
                    <path
                      d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z" />
                    <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z" />
                  </svg>
                  Home
                </a>
                <a class="nav-link d-flex align-items-center gap-2" href="#">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-bar-chart-fill" viewBox="0 0 16 16">
                    <path
                      d="M1 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3zm5-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2z" />
                  </svg>
                  Statistics
                </a>
                <hr class="my-3">
                <a class="nav-link d-flex align-items-center gap-2" href="/logout">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                      d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z" />
                    <path fill-rule="evenodd"
                      d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
                  </svg>
                  Sign out
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">My Tasks

          </h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <button type="button" id="create"
              class="btn btn-sm btn-outline-primary d-flex align-items-center gap-1 border-1 rounded-2 fw-medium">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus"
                viewBox="0 0 16 16">
                <path
                  d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
              </svg>
              Create Task
            </button>
          </div>
        </div>
        
        <div class="position-relative p-5" id="spinner">
          <div class="position-absolute top-50 start-50 translate-middle">
            <div class="spinner-border border-4" role="status">
              <span class="sr-only"></span>
            </div>
          </div>
        </div>

        <div class="table-responsive" id="tabledfg">
          <table id='dataTable' class="table table-hover">
            <thead id='thead'>
              <tr id='tr'>
                <th scope="col">Task Number</th>
                <th scope="col">Name</th>
                <th scope="col">Description</th>
                <th scope="col">Estimated time</th>
                <th scope="col">Deadline</th>
                <!-- <th scope="col">Status</th> -->
                <th scope="col" class="align-self-center">Action</th>
              </tr>
            </thead>

            <tbody id='tbody'>

              <!--tr>
                <td>Essay</td>
                <td>Write on given topic</td>
                <td>2h</td>
                <td>10/7/2023</td>
                <td ALIGN="left">
                  <select onchange="this.className=this.options[this.selectedIndex].className"
                    class="not-started border-1 rounded-2">
                    <option class="not-started border-1 rounded-2" value="not-started">Not started</option>
                    <option class="in-progress border-1 rounded-2" value="in-progress">In progress</option>
                    <option class="completed border-1 rounded-2" value="completed">Completed</option>
                  </select>
                </td>
              </tr-->
            </tbody>
          </table>
        </div>
      </main>
    </div>
  </div>


  <script>

    $(document).ready(function () {
      // Make the API call
      document.getElementById("tabledfg").style.display = "none";
      fetch('http://localhost:3000/data')

        .then(response => response.json())

        .then(data => {
          console.log(data);
          document.getElementById("spinner").style.display = "none";
          document.getElementById("tabledfg").style.display = "block";
          const createTaskButton = document.getElementById("create");
          createTaskButton.setAttribute("data-toggle", "modal");
          createTaskButton.setAttribute("data-target", "#createTaskModal");

          // Create and populate the table
          const dataTable = document.getElementById('dataTable');

          // Create table body
          const tbody = document.getElementById('tbody');

          let i = 0;
          data.forEach(rowData => {

            const row = document.createElement('tr');
            ++i;

            let j = 0;
            Object.values(rowData).forEach(value => {

              const cell = document.createElement('td');
              if (j == 0)
                cell.textContent = i;
              else
                cell.textContent = value;

              if (value == `${rowData.EstimatedTime}`) {
                cell.textContent = value.toString() + " hours";
              }

              ++j;
              row.appendChild(cell);
            });

            const cels = document.createElement('td');
            const editButton = document.createElement('button');
            editButton.type = "button";
            editButton.className = 'btn btn-outline-warning p-1 border-1 fw-medium';
            editButton.style.marginRight = '3px';
            editButton.innerHTML = "Edit";
            editButton.setAttribute("data-toggle", "modal");
            editButton.setAttribute("data-target", "#editButtonModal");

            cels.appendChild(editButton);

            editButton.addEventListener('click', function () {
              document.getElementById("taskName").value = rowData.Name;
              document.getElementById("taskDesc").value = rowData.Description;
              document.getElementById("taskEstTime").value = rowData.EstimatedTime;
              document.getElementById("taskDeadline").value = rowData.Deadline;
              document.getElementById("taskID").value = rowData.TaskID;
            });

            const deleteButton = document.createElement('button');
            deleteButton.type = "button";
            deleteButton.className = 'btn btn-outline-danger p-1 border-1 fw-medium';
            deleteButton.innerHTML = "Delete";
            deleteButton.setAttribute("data-toggle", "modal")
            deleteButton.setAttribute("data-target", "#deleteButtonModal");

            cels.appendChild(deleteButton);

            deleteButton.addEventListener('click', function () {
              deleteRow(`${rowData.TaskID}`);
            });

            row.appendChild(cels);

            tbody.appendChild(row);
          });

          dataTable.appendChild(tbody);
        })

        .catch(error => {
          console.error(error);
          window.location.reload();
        });

    });



    function editRow() {

      event.preventDefault(); // Prevent the default form submission behavior

      const saveChanges = document.getElementById("saveChanges");
      task_ID = document.getElementById("taskID").value;
      task_name = document.getElementById("taskName").value;
      task_description = document.getElementById("taskDesc").value;
      task_estimatedTime = document.getElementById("taskEstTime").value;
      task_deadline = document.getElementById("taskDeadline").value;
      saveChanges.setAttribute("data-dismiss", "modal");

      const data = {
        task_ID: task_ID,
        task_name: task_name,
        task_description: task_description,
        task_estimatedTime: task_estimatedTime,
        task_deadline: task_deadline
      };

      fetch('http://localhost:3000/api/update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(result => {
          console.log(result);
          window.location.reload();
          // Handle the response from the server as needed
        })
        .catch(error => {
          console.error('Error:', error);
          alert("Task was not updated. Try again.");
          // Handle any errors that occurred during the request
        });
    }

    function deleteRow(task_ID) {
      event.preventDefault(); // Prevent the default form submission behavior
      // console.log(task_ID, task_name, task_description, task_estimatedTime, task_deadline);


      const confirmDelete = document.getElementById("confirmDelete");
      confirmDelete.setAttribute("data-dismiss", "modal");

      confirmDelete.addEventListener('click', function () {
        const data = {
          task_ID: task_ID,
        };

        fetch('http://localhost:3000/api/delete', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
          .then(response => response.json())
          .then(result => {
            window.location.reload();
            // Handle the response from the server as needed
          })
          .catch(error => {
            console.error('Error:', error);
            alert("Task was not deleted. Try again.");
            // Handle any errors that occurred during the request
          });
      });

    }

    function createTask() {
      event.preventDefault(); // Prevent the default form submission behavior

      const taskCreate = document.getElementById("createTask");
      task_ID = document.getElementById("tID").value;
      task_name = document.getElementById("tName").value;
      task_description = document.getElementById("tDesc").value;
      task_estimatedTime = document.getElementById("tEstTime").value;
      task_deadline = document.getElementById("tDeadline").value;
      taskCreate.setAttribute("data-dismiss", "modal");

      const data = {
        task_ID: task_ID,
        task_name: task_name,
        task_description: task_description,
        task_estimatedTime: task_estimatedTime,
        task_deadline: task_deadline
      };

      fetch('http://localhost:3000/api/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(result => {
          window.location.reload();
          // Handle the response from the server as needed
        })
        .catch(error => {
          console.error('Error:', error);
          alert("Task was not created. Try again.");
          // Handle any errors that occurred during the request
        });
    }


  </script>

  <!--Edit Modal-->
  <div class="modal fade" id="editButtonModal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h5 class="modal-title w-100" id="ModalTitle">Edit Task</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-floating">
              <div class="form-group">
                <label for="taskName">Task Name:</label>
                <input type="hidden" class="form-control" id="taskID" />
                <input type="text" class="form-control" id="taskName" required />
              </div>
            </div>
            <div class="form-floating">
              <div class="form-group">
                <label for="taskDesc">Task Description:</label>
                <input type="text" class="form-control" id="taskDesc" />
              </div>
            </div>
            <div class="form-floating">
              <div class="form-group">
                <label for="taskEstTime">Estimated Time:</label>
                <input type="text" class="form-control" id="taskEstTime" />
              </div>
              <div class="form-floating">
                <div class="form-group">
                  <label for="taskDeadline">Deadline:</label>
                  <input type="date" class="form-control" id="taskDeadline" />
                </div>
              </div>
            </div>

          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
          <button type="button" id="saveChanges" class="btn btn-primary" onclick="editRow()">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteButtonModal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h5 class="modal-title w-100" id="ModalTitle">Delete Task</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this task?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-dismiss="modal">No</button>
          <button type="button" id="confirmDelete" class="btn btn-primary">Yes, delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Modal -->
  <div class="modal fade" id="createTaskModal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h5 class="modal-title w-100" id="ModalTitle">Create Task</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-floating">
              <div class="form-group">
                <label for="taskName">Task Name:</label>
                <input type="hidden" class="form-control" id="tID" />
                <input type="text" class="form-control" id="tName" required />
              </div>
            </div>
            <div class="form-floating">
              <div class="form-group">
                <label for="taskDesc">Task Description:</label>
                <input type="text" class="form-control" id="tDesc" />
              </div>
            </div>
            <div class="form-floating">
              <div class="form-group">
                <label for="taskEstTime">Estimated Time:</label>
                <input type="text" class="form-control" id="tEstTime" />
              </div>
              <div class="form-floating">
                <div class="form-group">
                  <label for="taskDeadline">Deadline:</label>
                  <input type="date" class="form-control" id="tDeadline" />
                </div>
              </div>
            </div>

          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
          <button type="button" id="createTask" class="btn btn-primary" onclick="createTask()">Create Task</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>

</body>

</html>